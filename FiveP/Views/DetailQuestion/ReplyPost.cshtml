@using FiveP.Models;
@model List<Reply_Post>
@{
    User user = (User)Session["user"];
    FivePEntities db = new FivePEntities();

    var varColororangered = "orangered";
    var varColorMain = "#172b4d";
}

@foreach (var item in Model)
{
    <section class="card mt-4">
        <div class="border p-2">
            <!-- post header -->
            <div class="row">
                <div class="col-2">
                    <!--Kiểm tra nút vow-->
                    @{
                        List<Rate_Reply_Post> listRateReplyPost_T = db.Rate_Reply_Post.Where(n => n.reply_post_id == item.reply_post_id && n.rate_reply_post1 == true).ToList();
                        List<Rate_Reply_Post> listRateReplyPost_F = db.Rate_Reply_Post.Where(n => n.reply_post_id == item.reply_post_id && n.rate_reply_post1 == false).ToList();
                        int intCoutT = listRateReplyPost_T.Count();
                        int intCoutF = listRateReplyPost_F.Count();
                        int intDivided = intCoutT - intCoutF;
                    }
                    <!--đánh giá-->
                    @if (user == null)
                    {
                        <center>
                            <button type="button" class="btn btn-sm"><i class="fa fa-chevron-up" style="font-size:200%"></i></button>
                        </center>
                        <center>
                            <div style="text-align: center">
                                <p style="margin-top:8px;">@intDivided</p>
                            </div>
                        </center>
                        <center>
                            <button type="button" class="btn btn-sm"><i class="fa fa-chevron-down" style="font-size:200%"></i></button>
                        </center>
                    }
                    else
                    {
                        Rate_Reply_Post checkUserRateReplyPostT = db.Rate_Reply_Post.Where(n => n.reply_post_id == item.reply_post_id && n.user_id == user.user_id && n.rate_reply_post1 == true).FirstOrDefault();
                        <center>
                            <form id="formRateReplyPostT@{@item.reply_post_id}" class="changSizeButtonRatePost">
                                <input type="hidden" name="reply_post_id" value="@item.reply_post_id" />
                                <button onclick="btnButtonChangeRateReplyPostT@{@item.reply_post_id}()" type="button" id="btnRateReplyPostT@{@item.reply_post_id}" class="btn btn-sm"><i class="fa fa-chevron-up" style="font-size:200%;color:@if (checkUserRateReplyPostT != null) { @varColororangered} else { @varColorMain}" id="RateReplyPostT@{@item.reply_post_id}"></i></button>
                            </form>
                        </center>
                        //vow trên
                        <center>
                            <div style="text-align: center">
                                <p style="margin-top:8px;" id="coutRateReplyPost@{@item.reply_post_id}">@intDivided</p>
                            </div>
                        </center>
                        //vow dưới
                        Rate_Reply_Post checkUserRateReplyPostF = db.Rate_Reply_Post.Where(n => n.reply_post_id == item.reply_post_id && n.user_id == user.user_id && n.rate_reply_post1 == false).FirstOrDefault();
                        <center>
                            <form id="formRateReplyPostF@{@item.reply_post_id}" class="changSizeButtonRatePost">
                                <input type="hidden" name="reply_post_id" value="@item.reply_post_id" />
                                <button onclick="btnButtonChangeRateReplyPostF@{@item.reply_post_id}()" type="button" id="btnRateReplyPostF@{@item.reply_post_id}" class="btn btn-sm"><i class="fa fa-chevron-down" style="font-size:200%;color:@if (checkUserRateReplyPostF != null) { @varColororangered} else { @varColorMain}" id="RateReplyPostF@{@item.reply_post_id}"></i></button>
                            </form>
                        </center>
                    }
                    <!--Hoạt động-->
                    @if (user == null)
                    {
                        <center>
                            <button type="button" class="btn btn-sm"><i class="ni ni-compass-04" style="font-size:200%"></i></button>
                        </center>


                    }
                    else if (user.user_id != item.user_id)
                    {
                        Show_Activate_Reply_Post showActivateReplyPost = db.Show_Activate_Reply_Post.Where(n => n.reply_post_id == item.reply_post_id && n.user_id == user.user_id).FirstOrDefault();
                        <center>
                            <form id="formShowActivateReplyPost@{@item.reply_post_id}" class="changSizeButtonRatePost">
                                <input type="hidden" name="reply_post_id" value="@item.reply_post_id" />
                                <button onclick="btnChangeShowActivateReplyPost@{@item.reply_post_id}()" type="button" id="btnButtonChangeActivateReplyPost@{@item.reply_post_id}" class="btn btn-sm"><i id="ShowActivateReplyPost@{@item.reply_post_id}" class="ni ni-compass-04" style="font-size:200%;color:@if (showActivateReplyPost != null) { @varColororangered} else { @varColorMain}"></i></button>
                            </form>
                        </center>
                    }
                    <!--hien thị hoạt động bài viết này-->

                </div>
                <div class="col-10">
                    <div class="row m-0">
                        <div class="">
                            <a class="text-decoration-none" href="#">
                                @if (item.User.user_img == null)
                                {
                                    <img class="" src="https://cdn3.iconfinder.com/data/icons/avatars-round-flat/33/avat-01-512.png" width="50" height="50" alt="...">
                                }
                                else
                                {
                                    <img class="profile-pic" src="~/Content/LayoutCenter/ImgUser/@item.User.user_img" width="50" height="50" alt="...">
                                }
                                
                            </a>
                        </div>
                        <div class="flex-grow-1 pl-2">
                            <a class="text-decoration-none" href="#">
                                <h2 class="text-capitalize h5 mb-0">@item.User.user_nicename</h2>
                            </a>
                            <p class="small text-dark m-0 mt-1">@item.User.user_vip_medal<i class="fab fa-galactic-senate" style="color:orangered;font-size:28px"></i> @item.User.user_gold_medal<i class="fas fa-medal" style="color:yellow"></i>  @item.User.user_silver_medal<i class="fas fa-medal" style="color:silver"></i>  @item.User.user_bronze_medal<i class="fas fa-medal" style="color:#e88d15"></i>  </p>

                        </div>

                        <div class="dropdown">
                            <a class="" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-chevron-down"></i>
                            </a>

                            <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                <a class="dropdown-item text-primary" href="#">Edit</a>
                                <a class="dropdown-item text-primary" href="#">Delete</a>
                            </div>
                        </div>

                    </div>
                    <!-- post body -->
                    <div class="">
                        <p class="my-2">
                            @Html.Raw(item.reply_post_content)
                        </p>
                    </div>
                    <div class="text-right">
                        <p>@item.reply_post_datecreated.Value.Day / @item.reply_post_datecreated.Value.Month / @item.reply_post_datecreated.Value.Year <i class="far fa-calendar-alt"></i></p>
                    </div>
                </div>
            </div>
            <hr class="my-1">
            <!-- post footer begins -->
            <footer class="">
                <!-- post actions -->
                <div class="">
                    @{
                        List<Comment> comments = db.Comments.Where(n => n.reply_post_id == item.reply_post_id).ToList();
                    }
                    <span class="text-right"></span>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item flex-fill text-center p-0 px-lg-2 border border-0">
                            
                        </li>


                        <li class="list-group-item flex-fill text-center p-0 px-lg-2 border border-0">
                           
                        </li>
                        <li class="list-group-item flex-fill text-center p-0 px-lg-2 border border-0">
                            <a class="small text-decoration-none float-right" data-toggle="collapse" href="#collapseExample@{ @item.reply_post_id}" role="button" aria-expanded="false" aria-controls="collapseExample">
                                <i class="fas fa-comment-alt" > &nbsp;@comments.Count() comment</i>
                            </a>
                        </li>
                    </ul>
                </div>


                <!-- collapsed comments begins -->
                <div class="collapse" id="collapseExample@{ @item.reply_post_id}">
                    <div class="border border-right-0 border-left-0 border-bottom-0 mt-1">
                        <!-- new comment form -->
                        @if (user != null)
                        {
                            <section class="mt-3">

                                <form action="@Url.Action("Comment","DetailQuestion")" method="post">
                                    <div class="input-group input-group">
                                        <input type="hidden" name="reply_post_id" value="@item.reply_post_id" />
                                        <input type="hidden" value="@user.user_id" />
                                        <input type="hidden" value="@DateTime.Now" />
                                        <input type="text" name="comment_content" required="" class="form-control" placeholder="Write Comment" aria-label="Recipient's username" aria-describedby="basic-addon2">
                                        <div class="input-group-append">
                                            <button type="submit" class="text-decoration-none text-white btn btn-primary" role="button">Comment</button>
                                        </div>
                                    </div>
                                </form>
                            </section>
                        }
                        <!-- comment card bgins -->
                        @Html.Action("Comment", "DetailQuestion", new { id = item.reply_post_id })

                        <!-- comment card ends -->

                    </div>
                </div>

                <!-- collapsed comments ends -->
            </footer>
            <!-- post footer ends -->
        </div>
    </section>
    <script>
    $(document).ready(function () {
            $("#btnRateReplyPostT@{@item.reply_post_id}").click(function () {
                var data = $("#formRateReplyPostT@{@item.reply_post_id}").serialize();
                $.ajax({
                type: "POST",
                    url: "/DetailQuestion/RateReplyPostT",
                data: data,
                success: function (response) {
                window.alert("Sữa thành công");
                $(this).show();
                    }
                })
            })
        })
        $(document).ready(function () {
            $("#btnRateReplyPostF@{@item.reply_post_id}").click(function () {
                var data = $("#formRateReplyPostF@{@item.reply_post_id}").serialize();
                $.ajax({
                    type: "POST",
                    url: "/DetailQuestion/RateReplyPostF",
                    data: data,
                    success: function (response) {
                        window.alert("Sữa thành công");
                        $(this).show();
                    }
                })
            })
        })
        //Save hiển thị hoạt động của bài viết (show activate reply post)
        $(document).ready(function () {
            $("#btnButtonChangeActivateReplyPost@{@item.reply_post_id}").click(function () {
                var data = $("#formShowActivateReplyPost@{@item.reply_post_id}").serialize();
                $.ajax({
                    type: "POST",
                    url: "/DetailQuestion/ShowActivateReplyPost",
                    data: data,
                    success: function (response) {
                        window.alert("Sữa thành công");
                        $(this).show();
                    }
                })
            })
        })
        //đổi màu các nút vow
        function btnButtonChangeRateReplyPostT@{@item.reply_post_id}()
        {
            if (document.getElementById("RateReplyPostF@{@item.reply_post_id}").style.color == 'orangered')
            {
                document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText = Number(document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText) + 2;
                document.getElementById("RateReplyPostT@{@item.reply_post_id}").style.color = "orangered";
                document.getElementById("RateReplyPostF@{@item.reply_post_id}").style.color = "#172b4d";
            }
            else if (document.getElementById("RateReplyPostT@{@item.reply_post_id}").style.color == 'orangered')
            {
                document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText = Number(document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText) - 1;
                document.getElementById("RateReplyPostT@{@item.reply_post_id}").style.color = "#172b4d";
            }
            else {
                document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText = Number(document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText) + 1;
                document.getElementById("RateReplyPostT@{@item.reply_post_id}").style.color = "orangered";
            }
        }
        function btnButtonChangeRateReplyPostF@{@item.reply_post_id}()
        {
            if (document.getElementById("RateReplyPostT@{@item.reply_post_id}").style.color == 'orangered') {
                document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText = Number(document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText) - 2;
                document.getElementById("RateReplyPostF@{@item.reply_post_id}").style.color = "orangered";
                document.getElementById("RateReplyPostT@{@item.reply_post_id}").style.color = "#172b4d";
            }
            else if (document.getElementById("RateReplyPostF@{@item.reply_post_id}").style.color == 'orangered') {
                document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText = Number(document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText) + 1;
                document.getElementById("RateReplyPostF@{@item.reply_post_id}").style.color = "#172b4d";
            }
            else {
                document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText = Number(document.getElementById("coutRateReplyPost@{@item.reply_post_id}").innerText) - 1;
                document.getElementById("RateReplyPostF@{@item.reply_post_id}").style.color = "orangered";
            }
        }
        //Đổi màu cho nút hiển thị hoạt động trả lời bài viết (show activate reply post)
        function btnChangeShowActivateReplyPost@{@item.reply_post_id}()
        {
            if (document.getElementById("ShowActivateReplyPost@{@item.reply_post_id}").style.color == "orangered")
            {
                document.getElementById("ShowActivateReplyPost@{@item.reply_post_id}").style.color = "#172b4d";
            }
            else {
                document.getElementById("ShowActivateReplyPost@{@item.reply_post_id}").style.color = 'orangered';
            }
        }
    </script>
}


